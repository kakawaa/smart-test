{% extends 'base.html' %}
{% load static %}
{% block title %}文件管理 - {{ directory }} {% endblock %}
{% block page-title %}
<a class="active" style="color: #1e71df" href="/file/manage/directory">文件管理</a>
<svg t="1635085520789" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="165732" width="200" height="200"><path d="M360.704 280.746667l45.226667-45.226667 246.570666 246.528a42.666667 42.666667 0 0 1 0 60.330667l-246.528 246.570666-45.22666601-45.269333 231.42400001-231.466667-231.466667-231.424z" p-id="165733"></path></svg>
{{ directory }}
{% endblock %}

{% block content %}
<div class="page-body">
    <div class="container-xl">
        <div class="row mt-3 mb-3">
            <div class="input-group" style="width: auto;min-width:25%">
                <div class="input-group-text">文件</div>
                <select id="filter_file" class="select2-selection--single" data-placeholder="请选择文件">
                    <option>全部</option>
                    {% for file_name in file_names %}
                    <option>{{ file_name.file_name }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="col-auto">
                <a id="upload_file" class="btn btn-default">
                    <svg t="1641460072887" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="22281" width="200" height="200"><path d="M753.2032 116.3264H271.104c-84.1728 0-152.6784 68.5056-152.6784 152.6784v487.936c0 84.1728 68.5056 152.6784 152.6784 152.6784h482.0992c84.1728 0 152.6784-68.5056 152.6784-152.6784v-487.936c0-84.1728-68.5056-152.6784-152.6784-152.6784z m-44.7488 549.7856a43.6224 43.6224 0 0 1-31.1808 13.1072c-11.0592 0-22.0672-4.1472-30.5664-12.4928l-94.0544-92.2112v169.2672c0 24.1152-19.5584 43.6736-43.6736 43.6736s-43.6736-19.5584-43.6736-43.6736v-163.072l-84.1728 83.6096c-17.1008 16.9984-44.8 16.896-61.7984-0.2048-16.9984-17.1008-16.896-44.8 0.2048-61.7984l155.1872-154.1632c20.2752-20.1216 53.3504-20.224 73.728-0.2048l159.4368 156.3136c17.2032 16.9472 17.4592 44.6464 0.5632 61.8496z m-26.2144-308.3776H346.1632c-24.1152 0-43.6736-19.5584-43.6736-43.6736s19.5584-43.6736 43.6736-43.6736h336.0768c24.1152 0 43.6736 19.5584 43.6736 43.6736s-19.5584 43.6736-43.6736 43.6736z" fill="#6C6CEA" p-id="22282"></path><path d="M753.2032 116.3264H271.104c-84.1728 0-152.6784 68.5056-152.6784 152.6784v487.936c0 84.1728 68.5056 152.6784 152.6784 152.6784h146.8928c274.0736-72.8064 476.0064-322.6112 476.0064-619.5712 0-32.0512-2.4064-63.5392-6.912-94.3616-26.0096-47.2576-76.2368-79.36-133.888-79.36z m-44.7488 549.7856a43.6224 43.6224 0 0 1-31.1808 13.1072c-11.0592 0-22.0672-4.1472-30.5664-12.4928l-94.0544-92.2112v169.2672c0 24.1152-19.5584 43.6736-43.6736 43.6736s-43.6736-19.5584-43.6736-43.6736v-163.072l-84.1728 83.6096c-17.1008 16.9984-44.8 16.896-61.7984-0.2048-16.9984-17.1008-16.896-44.8 0.2048-61.7984l155.1872-154.1632c20.2752-20.1216 53.3504-20.224 73.728-0.2048l159.4368 156.3136c17.2032 16.9472 17.4592 44.6464 0.5632 61.8496z m-26.2144-308.3776H346.1632c-24.1152 0-43.6736-19.5584-43.6736-43.6736s19.5584-43.6736 43.6736-43.6736h336.0768c24.1152 0 43.6736 19.5584 43.6736 43.6736s-19.5584 43.6736-43.6736 43.6736z" fill="#757BF2" p-id="22283"></path><path d="M118.4256 269.0048v433.1008c68.864-4.352 134.7584-19.5072 196.0448-43.8784-11.8784-17.1008-10.24-40.6528 5.0176-55.808l155.1872-154.1632c20.2752-20.1216 53.3504-20.224 73.728-0.2048l23.2448 22.784c28.7744-34.7648 53.9648-72.6528 74.9568-113.0496H346.1632c-24.1152 0-43.6736-19.5584-43.6736-43.6736s19.5584-43.6736 43.6736-43.6736h336.0768c0.6144 0 1.2288 0.0512 1.8432 0.1024 16.7936-48.9472 27.8016-100.608 32.256-154.1632H271.104c-84.1728-0.0512-152.6784 68.4544-152.6784 152.6272z" fill="#8486F8" p-id="22284"></path><path d="M118.4256 269.0048v175.0528c70.5536-23.3984 135.68-58.7264 192.9216-103.6288a43.30496 43.30496 0 0 1-8.9088-26.368c0-24.1152 19.5584-43.6736 43.6736-43.6736h41.1136c42.1888-45.6704 77.8752-97.536 105.4208-154.0608H271.104c-84.1728 0-152.6784 68.5056-152.6784 152.6784z" fill="#8D92F8" p-id="22285"></path></svg>
                    上传文件
                </a>
                <form id="form_id" method="post" enctype="multipart/form-data" style="display: none">
                    <div class="modal-body">
                        <input type="file" id="file" name="file">
                    </div>
                </form>
                <a id="progress_btn" class="btn btn-default disabled" style="margin-left: 10px;display: none;">
                    <div class="spinner-border spinner-border-sm text-muted dropdown-item-icon" role="status"></div>
                    <label class="filename"></label>
                    <label class="proress" style="margin-left: 10px;">上传中:0%</label>
                    <lable style="color: red;margin-left: 10px">请勿离开!</lable>
                </a>
            </div>
        </div>
        {% if file_num > 0 %}
        <div class="col-12">
            <div class="card">
                <div class="table-responsive" style="font-size: 15px;">
                    <table id="file_table" class="table card-table table-vcenter text-nowrap datatable">
                        <thead>
                        <tr>
                            <th class="w-10"></th>
                            <th style="font-size: 15px;">名称</th>
                            <th style="font-size: 15px;">文件大小</th>
                            <th style="font-size: 15px;">更新时间</th>
                            <th style="font-size: 15px;">创建人</th>
                            <th></th>
                        </tr>
                        </thead>
                        <tbody>
                        {% for file in files%}
                        <tr>
                            <td>
                                {% if file.file_type == 'video' %}
                                <span class="avatar avatar-sm" style="background-image: url(/static/image/video.png);background-color: white;"></span>
                                {% elif file.file_type == 'zip' %}
                                <span class="avatar avatar-sm" style="background-image: url(/static/image/zip.png);background-color: white;"></span>
                                {% elif file.file_type == 'image' %}
                                <span class="avatar avatar-sm" style="background-image: url(/static/image/image.png);background-color: white;"></span>
                                {% else %}
                                <span class="avatar avatar-sm" style="background-image: url(/static/image/other.png);background-color: white;"></span>
                                {% endif %}
                            </td>
                            <td><a target="_blank" href="http://47.106.194.167:8181/stest/file/{{ directory }}/{{ file.file_name }}">{{ file.file_name }}</a></td>
                            <td>{{ file.file_size }}</td>
                            <td>{{ file.ctime }}</td>
                            <td>{{ file.creater }}</td>
                            <td>
                                <div class="btn-list flex-nowrap">
                                    <div class="dropdown">
                                        <button class="btn dropdown-toggle align-text-top" data-bs-boundary="viewport" data-bs-toggle="dropdown">
                                             <svg t="1641460583720" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="26767" width="200" height="200"><path d="M496.8 181.22L392 283.26c-50.6 49.61-76.12 118.55-69.65 188.28s44.23 133.07 103.17 173.1a33 33 0 0 0 41.41-3.45l32.67-31.78a66.7 66.7 0 0 0 20.4-50.73 31.53 31.53 0 0 0-14.11-25 108.35 108.35 0 0 1-15-12.09 99 99 0 0 1 0-142.77L595.1 277.4a106.43 106.43 0 0 1 148.11 0.7c39.81 39.56 38.9 103.62-1.73 143.16l-20.29 19.79a31.34 31.34 0 0 0-7.71 33 264.27 264.27 0 0 1 14.6 77.31c1 27.59 35.23 40.48 55.13 21.12l57.55-56c95-92.47 95-242.9 0-335.28s-249.12-92.27-343.96 0.02z" fill="#3B82FE" p-id="26768"></path><path d="M605.82 384.49l-7.23-5.1a33 33 0 0 0-41.44 3.42l-32.67 31.71A66.84 66.84 0 0 0 504 465.26a31.53 31.53 0 0 0 14.14 25 109.6 109.6 0 0 1 15 12.09 99.05 99.05 0 0 1 0 142.79L428.92 746.61a106.44 106.44 0 0 1-148.13-0.73c-39.81-39.57-38.9-103.63 1.74-143.18l20.3-19.76a31.36 31.36 0 0 0 7.71-33A263.94 263.94 0 0 1 296 472.62c-1.05-27.6-35.24-40.49-55.14-21.13l-57.55 56c-95 92.43-95 242.91 0 335.3s249.14 92.3 344 0l104.86-102c50.57-49.62 76.08-118.55 69.61-188.27-6.27-66.87-41.21-127.83-95.96-168.03z" fill="#FC9C41" p-id="26769"></path></svg>
                                             DeepLink
                                            </button>
                                            <div class="dropdown-menu dropdown-menu-end">
                                                <a onclick="video_deeplink_code('http://47.106.194.167:8181/stest/file/{{ directory }}/{{ file.file_name }}','{{ file.file_name }}','xxxx')" class="dropdown-item" data-bs-toggle="modal" data-bs-target="#modal-deeplink">
                                                    <span class="avatar avatar-sm" style="background-image: url(https://play-lh.googleusercontent.com/XyRQ3Jjq4pSaAv0XtVnLcUPfkPDrRULoAhRUeOxR53xgxrGVR1Lde2UcnJgZvRFodyN4=s96-rw);background-color: white;width: 25px;margin-right: 10px;height: 25px;"></span>
                                                    xxxx拉起播放
                                                </a>
                                                <a onclick="download_deeplink_code('http://47.106.194.167:8181/stest/file/{{ directory }}/{{ file.file_name }}','{{ file.file_name }}','xxxx')" class="dropdown-item" data-bs-toggle="modal" data-bs-target="#modal-deeplink">
                                                    <span class="avatar avatar-sm" style="background-image: url(https://play-lh.googleusercontent.com/XyRQ3Jjq4pSaAv0XtVnLcUPfkPDrRULoAhRUeOxR53xgxrGVR1Lde2UcnJgZvRFodyN4=s96-rw);background-color: white;width: 25px;margin-right: 10px;height: 25px;"></span>
                                                    xxxx拉起下载
                                                </a>
                                                <a onclick="video_deeplink_code('http://47.106.194.167:8181/stest/file/{{ directory }}/{{ file.file_name }}','{{ file.file_name }}','xxxx')" class="dropdown-item" data-bs-toggle="modal" data-bs-target="#modal-deeplink">
                                                    <span class="avatar avatar-sm" style="background-image: url(https://play-lh.googleusercontent.com/FkIjTYpCHCEycYz418AaQeZqOwvpbthQ56YeSF2a3Q7SfPwWUzqLhLJA7rGjwo1jjKY=w480-h960-rw);background-color: white;width: 25px;margin-right: 10px;height: 25px;"></span>
                                                    xxxx拉起播放
                                                </a>
                                                <a onclick="download_deeplink_code('http://47.106.194.167:8181/stest/file/{{ directory }}/{{ file.file_name }}','{{ file.file_name }}','xxxx')" class="dropdown-item" data-bs-toggle="modal" data-bs-target="#modal-deeplink">
                                                    <span class="avatar avatar-sm" style="background-image: url(https://play-lh.googleusercontent.com/FkIjTYpCHCEycYz418AaQeZqOwvpbthQ56YeSF2a3Q7SfPwWUzqLhLJA7rGjwo1jjKY=w480-h960-rw);background-color: white;width: 25px;margin-right: 10px;height: 25px;"></span>
                                                    xxxx拉起下载
                                                </a>
                                            </div>
                                        </div>
                                        <a onclick="scan_code('http://47.106.194.167:8181/stest/file/{{ directory }}/{{ file.file_name }}')" class="btn btn-default" style="margin-right: 10px;" data-bs-toggle="modal" data-bs-target="#modal-qrcode">
                                            <svg t="1641460639623" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="28320" width="200" height="200"><path d="M785.6 154.2H680.3c-51.7 0-93.7 42-93.7 93.7v105.3c0 51.7 42 93.7 93.7 93.7h105.3c51.7 0 93.7-42 93.7-93.7V247.9c0-51.7-42-93.7-93.7-93.7z m48.3 93.7v105.3c0 26.6-21.6 48.3-48.3 48.3H680.3c-26.6 0-48.3-21.6-48.3-48.3V247.9c0-26.6 21.6-48.3 48.3-48.3h105.3c26.6 0 48.3 21.7 48.3 48.3z" fill="#FF4E7D" p-id="28321"></path><path d="M873 487.3h-2l-57.7 0.2c-10.2 0.1-18.5 8.5-18.5 18.7s8.3 18.6 18.5 18.7l57.6 0.2h2.1c10.3-0.1 18.7-8.6 18.7-18.9 0-10.3-8.4-18.8-18.7-18.9z" fill="#4E30DC" p-id="28322"></path><path d="M871 530.6l-57.7-0.2c-13.3-0.2-24-11-24-24.2s10.7-24 23.9-24.2l57.8-0.2h2.1c13.3 0.2 24.1 11.1 24.1 24.4 0 13.3-10.8 24.2-24.1 24.4H871z m-0.1-37.9l-57.6 0.2c-7.2 0.1-13 6-13 13.2 0 7.2 5.9 13.1 13.1 13.2l57.5 0.2h2c7.3-0.1 13.3-6.1 13.3-13.4 0-7.3-5.9-13.3-13.3-13.4h-2z" fill="#4E30DC" p-id="28323"></path><path d="M233.8 442.6h106.1c49.1 0 89-39.9 89-89V247.5c0-49.1-39.9-89-89-89H233.8c-49.1 0-89 39.9-89 89v106.1c0 49.1 39.9 89 89 89z m-54-89V247.5c0-29.8 24.2-54 54-54h106.1c29.8 0 54 24.2 54 54v106.1c0 29.8-24.2 54-54 54H233.8c-29.8 0-54-24.2-54-54z" fill="#4E30DC" p-id="28324"></path><path d="M339.9 448H233.8c-52.1 0-94.4-42.3-94.4-94.4V247.5c0-52.1 42.3-94.4 94.4-94.4h106.1c52.1 0 94.4 42.3 94.4 94.4v106.1c0 52-42.3 94.4-94.4 94.4zM233.8 163.8c-46.1 0-83.7 37.5-83.7 83.7v106.1c0 46.1 37.5 83.7 83.7 83.7h106.1c46.1 0 83.7-37.5 83.7-83.7V247.5c0-46.1-37.5-83.7-83.7-83.7H233.8zM339.9 413H233.8c-32.8 0-59.4-26.7-59.4-59.4V247.5c0-32.8 26.7-59.4 59.4-59.4h106.1c32.8 0 59.4 26.7 59.4 59.4v106.1c0 32.7-26.6 59.4-59.4 59.4zM233.8 198.8c-26.8 0-48.7 21.8-48.7 48.7v106.1c0 26.8 21.8 48.7 48.7 48.7h106.1c26.8 0 48.7-21.8 48.7-48.7V247.5c0-26.8-21.8-48.7-48.7-48.7H233.8zM339.9 576.6H233.8c-49.1 0-89.1 40-89.1 89.1v106.1c0 49.1 40 89.1 89.1 89.1h106.1c49.1 0 89.1-40 89.1-89.1V665.7c0-49.1-40-89.1-89.1-89.1z m54.1 89.1v106.1c0 29.8-24.3 54.1-54.1 54.1H233.8c-29.8 0-54.1-24.3-54.1-54.1V665.7c0-29.8 24.3-54.1 54.1-54.1h106.1c29.8 0 54.1 24.3 54.1 54.1z" fill="#4E30DC" p-id="28325"></path><path d="M339.9 866.2H233.8c-52 0-94.4-42.3-94.4-94.4V665.7c0-52 42.3-94.4 94.4-94.4h106.1c52 0 94.4 42.3 94.4 94.4v106.1c0 52-42.3 94.4-94.4 94.4zM233.8 581.9c-46.2 0-83.7 37.6-83.7 83.7v106.1c0 46.2 37.6 83.7 83.7 83.7h106.1c46.2 0 83.7-37.6 83.7-83.7v-106c0-46.2-37.6-83.7-83.7-83.7H233.8z m106.1 249.3H233.8c-32.7 0-59.4-26.6-59.4-59.4V665.7c0-32.7 26.6-59.4 59.4-59.4h106.1c32.7 0 59.4 26.6 59.4 59.4v106.1c0 32.8-26.6 59.4-59.4 59.4zM233.8 616.9c-26.9 0-48.7 21.9-48.7 48.7v106.1c0 26.9 21.9 48.7 48.7 48.7h106.1c26.9 0 48.7-21.9 48.7-48.7v-106c0-26.9-21.9-48.7-48.7-48.7H233.8zM790.3 575.7H683.4c-49.4 0-89.7 40.2-89.7 89.7v106.8c0 49.4 40.2 89.7 89.7 89.7h106.8c49.4 0 89.7-40.2 89.7-89.7V665.3c0.1-49.4-40.2-89.6-89.6-89.6z m54.4 89.6v106.8c0 30-24.4 54.4-54.4 54.4H683.4c-30 0-54.4-24.4-54.4-54.4V665.3c0-30 24.4-54.4 54.4-54.4h106.8c30.1 0 54.5 24.4 54.5 54.4z" fill="#4E30DC" p-id="28326"></path><path d="M790.3 867.2H683.4c-52.4 0-95-42.6-95-95V665.3c0-52.4 42.6-95 95-95h106.8c52.4 0 95 42.6 95 95v106.8c0.1 52.5-42.5 95.1-94.9 95.1zM683.4 581c-46.5 0-84.3 37.8-84.3 84.3v106.8c0 46.5 37.8 84.3 84.3 84.3h106.8c46.5 0 84.3-37.8 84.3-84.3V665.3c0-46.5-37.8-84.3-84.3-84.3H683.4z m106.9 251H683.4c-33 0-59.8-26.8-59.8-59.8V665.3c0-33 26.8-59.8 59.8-59.8h106.8c33 0 59.8 26.8 59.8 59.8v106.8c0.1 33-26.7 59.9-59.7 59.9zM683.4 616.2c-27.1 0-49.1 22-49.1 49.1v106.8c0 27.1 22 49.1 49.1 49.1h106.8c27.1 0 49.1-22 49.1-49.1V665.3c0-27.1-22-49.1-49.1-49.1H683.4z" fill="#4E30DC" p-id="28327"></path><path d="M630.6 526.9h0.2c10.3-0.1 18.6-8.6 18.6-18.9 0-10.3-8.3-18.8-18.6-18.9H530.3V326.7c-0.2-10.1-8.6-18.4-18.7-18.4-10.2 0-18.6 8.3-18.7 18.4V489H328.8l-153.8 0.2h-0.3c-10.1 0.3-18.2 8.6-18.2 18.7 0 10.2 8.3 18.6 18.4 18.7h0.1l153.8 0.2h163.9V693.3c0.1 10.3 8.6 18.6 18.9 18.6s18.8-8.4 18.9-18.7V526.8l100.1 0.1z" fill="#4E30DC" p-id="28328"></path><path d="M511.6 717.4c-13.3 0-24.3-10.8-24.4-24v-161H328.8l-153.8-0.2h-0.1c-13.2-0.2-23.9-11-23.9-24.2 0-13 10.6-23.9 23.6-24.2h0.4l153.7-0.2h158.6V326.7c0.2-13.2 11-23.9 24.2-23.9 13.1 0 24 10.7 24.2 23.8V483.5h95c13.3 0.2 24.1 11.1 24.1 24.4 0 13.3-10.8 24.3-24 24.4H536v160.9c-0.2 13.4-11.1 24.2-24.4 24.2z m-13.5-24.1c0.1 7.3 6.1 13.2 13.4 13.2 7.3 0 13.3-5.9 13.4-13.2V521.5h105.7c7.3-0.1 13.2-6.1 13.2-13.4 0-7.3-5.9-13.3-13.2-13.4H524.7l-0.1-6.6V327c-0.1-7.1-6.1-13-13.2-13-7.2 0-13.1 5.8-13.2 13v162.3l-0.1 5.4H328.5l-153.9 0.2c-7.1 0.2-12.9 6.1-12.9 13.2 0 7.2 5.8 13.1 13 13.2l153.8 0.2h169.4l0.2 171.8z" fill="#4E30DC" p-id="28329"></path><path d="M511.6 782.3c-10.2 0-18.6 8.3-18.7 18.4l-0.2 59.8v0.1c0.1 10.3 8.6 18.6 18.9 18.6s18.8-8.4 18.9-18.6l-0.2-59.8c-0.2-10.2-8.6-18.5-18.7-18.5z" fill="#4E30DC" p-id="28330"></path><path d="M511.6 884.7c-13.3 0-24.3-10.8-24.4-24.1v-0.2l0.2-59.8c0.2-13.2 11-23.9 24.2-23.9s24 10.7 24.2 23.9l0.2 59.8c-0.2 13.5-11.1 24.3-24.4 24.3z m0-96.9c-7.2 0-13.1 5.8-13.2 13l-0.2 59.8c0.1 7.2 6.1 13.1 13.4 13.1s13.3-5.9 13.4-13.2l-0.2-59.7c-0.1-7.1-6.1-13-13.2-13z" fill="#4E30DC" p-id="28331"></path><path d="M510.6 247.7c10.6 0 19.3-8.6 19.5-19.1v-0.1l-0.2-62.1c-0.1-10.5-8.8-19-19.2-19-10.5 0-19.1 8.5-19.3 18.9l-0.2 62.2v0.2c0.1 10.4 8.8 19 19.4 19z" fill="#4E30DC" p-id="28332"></path><path d="M510.6 253.2c-13.6 0-24.8-11-25-24.6v-0.2l0.2-62.2c0.2-13.5 11.3-24.4 24.8-24.4s24.6 11 24.7 24.5l0.2 62.3v0.1c-0.1 13.5-11.3 24.5-24.9 24.5z m0-100.4c-7.5 0-13.7 6-13.8 13.4l-0.2 62.3c0.1 7.5 6.4 13.7 14 13.7s13.9-6.2 14-13.7v-0.1l-0.2-62c-0.1-7.5-6.3-13.6-13.8-13.6z" fill="#4E30DC" p-id="28333"></path></svg>
                                            扫码
                                        </a>
                                        <a onclick="del_directory_file('{{ file.file_name }}')" class="btn btn-default" data-bs-toggle="modal" data-bs-target="#modal-danger">
                                            <svg t="1635400029781" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="17941" width="200" height="200"><path d="M877.79 217.23H624.22c0-36.02-29.2-65.23-65.23-65.23H465c-36.02 0-65.23 29.2-65.23 65.23H146.21c-18.01 0-32.61 14.6-32.61 32.61 0 18.01 14.6 32.61 32.61 32.61h49.75l14.43 528.79c1.06 33.91 25.21 60.76 54.64 60.76h493.93c29.43 0 53.58-26.86 54.64-60.76l14.48-528.79h49.7c18.01 0 32.61-14.6 32.61-32.61 0.01-18.01-14.59-32.61-32.6-32.61zM364.24 748.41c-17.98 0.82-33.4-10.01-34.44-24.19L308 427.56c-1.04-14.18 12.69-26.34 30.67-27.16 17.98-0.82 33.4 10.01 34.45 24.19l21.8 296.67c1.04 14.17-12.7 26.33-30.68 27.15z m180.37-25.42c0 14.2-14.6 25.72-32.61 25.72-18.01 0-32.61-11.51-32.61-25.72V425.83c0-14.2 14.6-25.72 32.61-25.72 18.01 0 32.61 11.51 32.61 25.72v297.16zM716 427.56l-21.8 296.67c-1.04 14.18-16.46 25.01-34.44 24.19-17.98-0.82-31.71-12.98-30.67-27.16l21.8-296.67c1.04-14.18 16.46-25.01 34.44-24.19 17.98 0.82 31.72 12.98 30.67 27.16z" fill="#FF5D5D" p-id="17942"></path></svg>
                                            删除
                                        </a>
                                </div>        
                            </td>
                        </tr>
                        {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        {% else %}
        <div class="empty">
            <div class="empty-img"><img src="/static/tabler/static/illustrations/undraw_printing_invoices_5r4r.svg"></div>
            <p class="empty-title">No results found</p>
        </div>
        {% endif %}
    </div>
</div>

<div class="modal modal-blur fade" id="modal-qrcode" tabindex="-1" role="dialog" aria-hidden="true" data-backdrop="static">
    <div class="modal-dialog modal-sm modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">扫码访问</h5>
                <button type="button" class="btn-close dismiss" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body" style="margin:0 auto;">
                <div id="qrcode"></div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn dismiss" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<div class="modal modal-blur fade" id="modal-deeplink" tabindex="-1" role="dialog" aria-hidden="false">
    <div class="modal-dialog modal-sm modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">DeepLink</h5>
                <button type="button" class="btn-close dismiss" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body" style="margin:0 auto;">
                <div id="deeplink"></div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn dismiss" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<div class="modal modal-blur fade" id="modal-danger" tabindex="-1" role="dialog" aria-hidden="false">
    <div class="modal-dialog modal-sm modal-dialog-centered" role="document">
        <div class="modal-content">
            <button type="button" class="btn-close dismiss" data-bs-dismiss="modal" aria-label="Close"></button>
            <div class="modal-status bg-danger"></div>
            <div class="modal-body text-center py-4">
                <svg xmlns="http://www.w3.org/2000/svg" class="icon mb-2 text-danger icon-lg" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M12 9v2m0 4v.01" /><path d="M5 19h14a2 2 0 0 0 1.84 -2.75l-7.1 -12.25a2 2 0 0 0 -3.5 0l-7.1 12.25a2 2 0 0 0 1.75 2.75" /></svg>
                <h3>确认删除?</h3>
                <div class="text-muted directory-file-name"></div>
            </div>
            <div class="modal-footer">
                <div class="w-100">
                    <div class="row">
                        <div class="col">
                            <a  class="btn btn-white w-100 dismiss" data-bs-dismiss="modal">
                            取消
                            </a>
                        </div>
                        <div class="col">
                            <a  id="del_file_confirm" class="btn btn-danger w-100">
                            确认
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block script %}
<script>
    $('#file_tab').addClass('active');
    var input = document.getElementById('file');
    document.getElementById('upload_file').onclick = function () {
        input.click();
    };

    var file_table = maketable({Table:'#file_table',paging:false})

    //文件过滤
    $('#filter_file').on('keyup change', function () {
        let filename = this.value;
        if (filename=='全部'){
            file_table.column(1).search('').draw();
        }else{
            file_table.column(1).search(this.value).draw();
        }
    });

    //文件上传
    $('#file').on('keyup change', function () {
        var form_data = new FormData();
        var file_name = this.files[0].name
        var file_obj =this.files[0];
        var file_size = this.files[0].size
        form_data.append('file',file_obj);
        form_data.append('directory','{{ directory }}');
        form_data.append('file_name',file_name);
        form_data.append('file_size',file_size);
        form_data.append('creater',owner);
        console.log('filename:'+file_name)
        console.log(file_obj)
        if(file_name.indexOf(".") != -1){
                $.ajax({
                    url: "/file/api/upload_file",
                    type: "POST",
                    async:true,
                    cache: false,
                    processData: false,
                    contentType: false,
                    data: form_data,
                    beforeSend: function () {
                        document.getElementById("upload_file").style.display="none";
                        document.getElementById("progress_btn").style.display="block";
                        $('.filename').text(file_name)
                        $('.proress').text('上传中:0%')
                        },
                    xhr: function() {
                        let newxhr = new XMLHttpRequest()
                        newxhr.upload.onprogress = function(e) {
                            console.log(e)
                            let percent = parseInt((e.loaded / e.total) * 100) + '%'
                            if(parseInt((e.loaded / e.total) * 100)<100){
                                $('.proress').text('上传中:'+percent)
                            }
                            console.log(percent)
                        }
                        return newxhr
                    },
                    complete: function () {
                        document.getElementById("progress_btn").style.display="none";
                        document.getElementById("upload_file").style.display="block";
                    },
                    success: function (data) {
                        //console.log(data)
                        location.reload()
                    }
                });
        }else{
            Spop(SPOP_TYPE.error,'异常文件，没有后缀')
        }
    });
    //扫码
    function scan_code(link){
        var qrcode = new QRCode(document.getElementById("qrcode"))
        qrcode.makeCode(link)
    }

    //deeplink video
    function video_deeplink_code(link,title,anm){
        switch (anm) {
            case 'xxxx':
                deeplink_head = 'xxxx://playerv2'
                break;
            case 'xxxx':
                deeplink_head = 'xxxx://com.xxxx.app'
                break;
            default:
                deeplink_head = 'xxxx://playerv2'
        }
        let encode_link = encodeURIComponent(link)
        let encode_title = encodeURIComponent(title.split('.')[0])
        let deeplink_base = deeplink_head+'/video?url='+encode_link+'&title='+encode_title+'&referrer=utm_source%3DGP_FILEUP%26utm_campaign%3DTG_u4tbm6ka1QJOhYfA%26utm_content%3Dfp2tg300003w%26utm_medium%3Dptplay%26utm_term%3D8B9F5695-D49F-4A3A-A813-8B78960F8E81%26utm_view%3D3&source=web_fileup'
        var qrcode = new QRCode(document.getElementById("deeplink"))
        console.log(deeplink_base)
        qrcode.makeCode(deeplink_base)
    }

    //deeplink download
    function download_deeplink_code(link,title,anm){
        switch (anm) {
            case 'xxxx':
                deeplink_head = 'xxxx://playerv2'
                break;
            case 'xxxx':
                deeplink_head = 'xxxx://com.xxxx.app'
                break;
            default:
                deeplink_head = 'xxxx://playerv2'
        }
        let encode_link = encodeURIComponent(link)
        let encode_title = encodeURIComponent(title.split('.')[0])
        let deeplink_base = deeplink_head+'/download?url='+encode_link+'&title='+encode_title+'&cover=https%3A%2F%2Fup.fuplink.net%2Fconfig%2Fcontent%2Fdefault_cover.png%3Ftoken%3Dbdeca4d008478a9a4ab4c82df2dcac79%26ts%3D1641537264&referrer=utm_source%3DGP_FILEUP%26utm_campaign%3DTG_u4tbm6ka1QJOhYfA%26utm_content%3Dfp2tg300003w%26utm_medium%3Dptplay%26utm_term%3D8B9F5695-D49F-4A3A-A813-8B78960F8E81%26utm_view%3D3&source=web_fileup'
        var qrcode = new QRCode(document.getElementById("deeplink"))
        console.log(deeplink_base)
        qrcode.makeCode(deeplink_base)
    }
    
    //删除记录
    function del_directory_file(file_name){
        $('.directory-file-name').text(file_name)
        $('#del_file_confirm').on('click', function () {
            $.ajax({
                url: "/file/api/delete_directory_file",
                type: "POST",
                async: true,
                cache: false,
                data:{
                    directory_name: '{{ directory }}',
                    file_name:file_name,
                    creater:owner
                },
                beforeSend: function () {
                    loading();
                    },
                complete: function () {
                    removeLoading()
                },
                success: function (data) {
                    if(data['status'] != 1 ){
                        Spop(SPOP_TYPE['error'],data['msg'])
                    }else{
                        location.reload()
                    }
                }
            });
        });
    }

    $('.dismiss').on('click', function () {
        window.event.preventDefault()
        location.reload()
    });
</script>
{% endblock %}
