{% extends 'api_base.html' %}
{% block title %}自动化测试 - {{ taskname }}{% endblock %}
{% block page-title %}
<a class="active" style="color: #1e71df" href="/api_test/automation">自动化测试</a>
<svg t="1635085520789" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="165732" width="200" height="200"><path d="M360.704 280.746667l45.226667-45.226667 246.570666 246.528a42.666667 42.666667 0 0 1 0 60.330667l-246.528 246.570666-45.22666601-45.269333 231.42400001-231.466667-231.466667-231.424z" p-id="165733"></path></svg>
{{ taskname }}
{% endblock %}

{% block api_tab %}
<li class="nav-item">
    <a  onclick="tab_click('post')" class="nav-link" data-bs-toggle="tab"><!-- Download SVG icon from http://tabler-icons.io/i/home -->
        <svg xmlns="http://www.w3.org/2000/svg" class="icon me-2" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><circle cx="12" cy="7" r="4" /><path d="M6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2" /></svg>
        手工测试
    </a>
</li>
<li class="nav-item">
    <a  onclick="tab_click('automation')" class="nav-link active" data-bs-toggle="tab"><!-- Download SVG icon from http://tabler-icons.io/i/user -->
        <svg t="1636172939547" class="icon me-2" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4269" width="200" height="200"><path d="M212.704 410.208l-13.76-14.88-109.696 101.472 108.064 96.192 13.504-15.104-91.36-81.376zM535.904 410.208l13.856-14.88 109.6 101.472-108.032 96.192-13.44-15.104 91.328-81.376z" p-id="4270"></path><path d="M551.2 596.384l-16.704-18.688 91.2-81.216-93.12-86.112 17.056-18.432 113.376 104.928-1.984 1.76zM197.504 596.384l-1.792-1.6-110.048-97.952 1.952-1.792 111.424-103.136 17.056 18.432-93.088 86.112 91.168 81.216-16.672 18.72z m-104.672-99.616l104.288 92.832 10.304-11.52-91.552-81.504 1.952-1.792 91.488-84.64-10.528-11.424-105.952 98.048z" p-id="4271"></path><path d="M50.368 274.24h913.344v-20.288H50.368z" p-id="4272"></path><path d="M966.112 276.64H47.968V251.52h918.144v25.12z m-913.344-4.8h908.544v-15.488H52.768v15.488z" p-id="4273"></path><path d="M121.376 193.056h20.288v20.32h-20.288z" p-id="4274"></path><path d="M144.064 215.776h-25.088v-25.12h25.088v25.12z m-20.256-4.832h15.456v-15.488h-15.456v15.488z" p-id="4275"></path><path d="M202.592 193.056h20.288v20.32h-20.288z" p-id="4276"></path><path d="M225.28 215.776h-25.12v-25.12h25.12v25.12z m-20.288-4.832h15.488v-15.488h-15.488v15.488z" p-id="4277"></path><path d="M283.744 193.056h20.288v20.32h-20.288z" p-id="4278"></path><path d="M306.432 215.776h-25.088v-25.12h25.088v25.12z m-20.288-4.832h15.456v-15.488h-15.456v15.488z" p-id="4279"></path><path d="M60.48 883.136V152.448H953.6v552.032c1.408-0.16 2.72-0.48 4.288-0.48 5.92 0 11.072 0.992 16 2.336V132.16H40.192v771.2h598.176a59.776 59.776 0 0 1-11.008-20.32H60.48v0.096z" p-id="4280"></path><path d="M643.488 905.824H37.792V129.76h938.496v579.776l-3.04-0.768a56.448 56.448 0 0 0-15.36-2.208 15.744 15.744 0 0 0-2.56 0.256l-4.128 0.544V154.848H62.88v725.856h566.272l0.544 1.728c2.304 7.328 5.888 13.92 10.528 19.456l3.264 3.936z m-600.864-4.832h590.88a59.264 59.264 0 0 1-7.84-15.488H58.08V150.048h897.92v551.776c4.576-0.48 9.952 0.256 15.424 1.504V134.592H42.624v766.4z" p-id="4281"></path><path d="M458.144 367.36l-152.32 263.648-17.6-10.176 152.288-263.648z" p-id="4282"></path><path d="M306.688 634.24l-21.76-12.576 1.216-2.016 153.504-265.728 21.76 12.576z" p-id="4283"></path><path d="M578.016 814.592c0.064 0.032 0.064 0.096 0.128 0.096-0.032 0.064-0.096 0.032-0.128-0.096z" p-id="4284"></path><path d="M841.056 980.928l-3.328-0.192a50.752 50.752 0 0 1-32.544-13.568l-4.768-5.408c-4.288-7.328-18.496-15.2-29.92-15.2a23.392 23.392 0 0 0-20.096 12.128l-3.936 5.632c-18.304 17.312-37.6 20.096-57.792 10.464l-52.768-30.624a48.096 48.096 0 0 1-15.008-56.448c1.568-3.936 2.56-8.32 2.688-12.16 0-16.48-12.416-30.72-28.128-29.984a35.52 35.52 0 0 1-32.704-18.912c-0.64-1.12-1.472-3.072-1.984-4.256l-0.096-0.192-6.528-14.784a223.68 223.68 0 0 1-0.096-90.336c4.48-24.032 19.616-38.56 40.48-38.56 15.168-0.064 27.616-13.568 27.648-29.44a38.944 38.944 0 0 0-2.688-12.576 48.448 48.448 0 0 1 15.712-57.152l3.52-2.304 55.456-31.2c6.56-1.92 11.424-2.56 15.584-2.56 13.6 0 25.76 4.704 34.976 13.312l4.448 4.768c15.2 24.032 45.344 8.96 49.056 3.04l4.32-5.728c18.56-16.608 37.984-18.048 56.992-9.28l52.832 30.784c17.44 13.312 23.424 36.896 15.2 56.704a41.664 41.664 0 0 0-2.752 12.384c0.032 10.4 2.368 29.376 18.144 29.376h3.712c20.832 0 36.512 14.688 40.864 38.304 6.144 29.344 6.176 60.64 0.064 90.08-4.512 23.744-20.192 38.688-40.864 38.688-16.352 0-18.08 20.672-18.08 29.568 0.224 4.224 1.088 8.64 2.72 12.672 8.384 20.416 1.92 43.968-15.84 57.088l-3.392 2.24-52.736 29.92a47.776 47.776 0 0 1-18.368 3.712z m-70.528-66.336c21.76 0 46.976 12.896 56.192 28.736a18.72 18.72 0 0 0 12.864 5.472l1.472 16.128v-16a18.816 18.816 0 0 0 5.568-0.864l49.76-28.48a16.32 16.32 0 0 0 5.44-19.52 72.224 72.224 0 0 1-4.992-23.904c-0.032-37.568 20.096-62.304 50.048-62.304 5.824 0 8.384-7.04 9.504-12.928a191.808 191.808 0 0 0-0.064-77.664c-1.568-8.416-4.736-12.512-9.504-12.512h-3.712c-30.432 0-50.112-24.448-50.112-62.272 0.448-8.448 2.176-16.256 5.056-23.488 2.784-6.72 0.928-14.784-4.128-18.656l-48.992-28.448a15.392 15.392 0 0 0-6.688-1.504h-0.032a18.048 18.048 0 0 0-12.288 4.576c-10.496 16.608-36.32 26.144-55.488 26.144a55.36 55.36 0 0 1-46.784-26.368 18.176 18.176 0 0 0-12.992-5.344h-0.032a19.616 19.616 0 0 0-5.12 0.608l-50.848 28.96a16.544 16.544 0 0 0-5.408 19.584c2.944 7.328 4.64 15.328 4.992 23.904 0 34.432-26.528 61.984-59.072 62.144-2.56-0.064-7.296 0.032-9.664 12.736a192.128 192.128 0 0 0 0.064 77.728l0.448 1.152c0.928 1.44 1.728 2.688 2.336 3.744l2.016 4.16-2.336 18.528 4.896-15.232a62.112 62.112 0 0 1 62.688 62.784c-0.32 8.128-2.016 16.032-5.024 23.552-2.752 6.624-0.896 14.688 4.128 18.496l48.864 28.224a14.816 14.816 0 0 0 6.688 1.536 17.824 17.824 0 0 0 12.16-4.896c10.432-17.792 28.736-28.512 48.096-28.512z" p-id="4285"></path><path d="M775.584 894.688a132.608 132.608 0 0 1-132.512-132.448c0-73.088 59.424-132.576 132.512-132.576s132.544 59.456 132.544 132.576a132.64 132.64 0 0 1-132.544 132.448z m0-232.992a100.672 100.672 0 0 0-100.512 100.576 100.608 100.608 0 0 0 100.512 100.448 100.608 100.608 0 0 0 100.544-100.448 100.672 100.672 0 0 0-100.544-100.576z" p-id="4286"></path></svg>
        自动化测试
    </a>
</li>
<li class="nav-item">
    <a  onclick="tab_click('stress')" class="nav-link" data-bs-toggle="tab"><!-- Download SVG icon from http://tabler-icons.io/i/user -->
        <svg t="1636371462410" class="icon me-2" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2741" width="200" height="200"><path d="M461.223546 894.876154c-1.062192 0-2.099824-0.048095-3.162016-0.193405-11.732206-1.497097-20.736277-11.103896-21.532409-22.884197l-40.336684-605.249801L287.129486 630.065999c-3.186576 10.670014-14.097066 17.911952-24.260543 17.621333-11.128455-0.2415-20.711717-7.91732-23.390733-18.732643l-38.864146-155.385976-68.000743 68.000743c-4.634554 4.634554-10.911514 7.241938-17.477047 7.241938L65.698305 548.811394l0-49.437969 39.20286 0 91.634-91.634c6.300496-6.300496 15.425318-8.810666 24.067138-6.348592 8.593725 2.38942 15.231913 9.197476 17.380856 17.839297l27.6395 110.48637 122.460076-408.222425c3.451612-11.466146 14.677281-18.732643 26.456558-17.477047 11.876492 1.351787 21.097504 11.007705 21.894659 22.932292l41.061185 616.136755 108.555391-325.68971c3.186576-9.487072 11.732206-16.125259 21.725814-16.825201 10.041704-0.627287 19.408025 4.634554 23.850198 13.59053l76.763314 153.526629 27.326369-54.651714c4.200672-8.376785 12.745279-13.663184 22.1116-13.663184l197.750853 0 0 49.437969L773.08225 548.811394l-42.581818 85.212754c-8.400321 16.70445-35.82288 16.70445-44.223201 0l-72.176856-144.378272L484.638839 877.978299C481.259882 888.165312 471.724715 894.876154 461.223546 894.876154z" p-id="2742"></path></svg>
        压力测试
    </a>
</li>
{% endblock %}

{% block api_tab_content %}
<div class="tab-pane active">
    <div class="row mb-3">
        <div class="input-group" style="width: 20%">
            <div class="input-group-text">接口</div>
            <select class="select2-selection--single" data-placeholder="Choose one thing">
                <option>全部</option>
                {% for api_name in api_names %}
                <option>{{ api_name.apiname }}</option>
                {% endfor %}
            </select>
        </div>

        <div class="col-auto">
            <a  id="new_api" class="btn btn-default" data-bs-toggle="modal" data-bs-target="#modal-new-api">
                <svg t="1638003419490" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="101642" width="200" height="200"><path d="M0 0m512 0l0 0q512 0 512 512l0 0q0 512-512 512l0 0q-512 0-512-512l0 0q0-512 512-512Z" fill="#517EFF" p-id="101643"></path><path d="M704 448a64 64 0 0 1 7.488 127.552L704 576H320a64 64 0 0 1-7.488-127.552L320 448h384z" fill="#FFFFFF" p-id="101644"></path><path d="M512 256a64 64 0 0 1 63.552 56.512L576 320v384a64 64 0 0 1-127.552 7.488L448 704V320a64 64 0 0 1 64-64z" fill="#FFFFFF" p-id="101645"></path></svg>
                接口
            </a>
            {% if api_num > 0 %}
            {% if running_task_num == 0 %}
            <a  id="run_all_task" class="btn btn-default" style="margin-left: 10px">
                <svg t="1638001356313" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="73544" width="200" height="200"><path d="M511.488 511.488m-511.488 0a511.488 511.488 0 1 0 1022.976 0 511.488 511.488 0 1 0-1022.976 0Z" fill="#E0E2E1" p-id="73545"></path><path d="M766.464 560.64c27.136-18.944 34.304-56.32 15.36-83.456-4.096-6.144-9.216-11.264-15.36-15.36l-318.464-219.136c-27.136-18.944-65.024-11.776-83.456 15.36-6.656 10.24-10.752 22.016-10.752 34.304v438.272c0 33.28 27.136 60.416 59.904 60.416 12.288 0 24.064-3.584 34.304-10.752l318.464-219.648z" fill="#1AAA5E" p-id="73546"></path></svg>
                全部执行
            </a>
            {% else %}
            <a class="btn btn-default disabled" style="margin-left: 10px">
                <div class="spinner-border spinner-border-sm text-muted dropdown-item-icon" role="status"></div>
                执行中
            </a>
            {% endif %}
            <a href="/api_test/automation/{{ taskname }}/report/{{ last_run_id }}" class="btn btn-default" style="margin-left: 10px">
                <svg t="1638004558437" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="106091" width="200" height="200"><path d="M777 806.7c0 38.7-31.1 70.3-69.7 70.3H225.9c-38.7 0-69.9-31.6-69.9-70.3V174.4c0-38.7 31.2-70.4 69.9-70.4h481.4c38.7 0 69.7 31.7 69.7 70.4v632.3z" fill="#FFFFFF" p-id="106092"></path><path d="M707.3 886H225.9c-43.5 0-78.9-35.8-78.9-79.3V174.4c0-43.5 35.4-79.4 78.9-79.4h481.4c43.5 0 79.7 35.9 79.7 79.4v632.3c0 43.5-36.2 79.3-79.7 79.3zM225.9 113c-33.7 0-59.9 27.7-59.9 61.4v632.3c0 33.7 26.2 61.3 59.9 61.3h481.4c33.7 0 60.7-27.6 60.7-61.3V174.4c0-33.7-27-61.4-60.7-61.4H225.9z" fill="#282828" p-id="106093"></path><path d="M732 763.1c0 33.3-26.1 60.9-59.4 60.9H251.7c-33.3 0-59.7-27.6-59.7-60.9V226.9c0-33.3 26.4-60.9 59.7-60.9h420.9c33.3 0 59.4 27.5 59.4 60.9v536.2z" fill="#50BCFF" p-id="106094"></path><path d="M361.8 251.9H208.6c-4.9 0-8.9-4-8.9-8.9s4-8.9 8.9-8.9h153.1c4.9 0 8.9 4 8.9 8.9s-3.9 8.9-8.8 8.9zM549.2 313H208.6c-4.9 0-8.9-4-8.9-8.9s4-8.9 8.9-8.9h340.5c4.9 0 8.9 4 8.9 8.9s-3.9 8.9-8.8 8.9zM652 448.4H208.6c-4.9 0-8.9-4-8.9-8.9s4-8.9 8.9-8.9H652c4.9 0 8.9 4 8.9 8.9s-4 8.9-8.9 8.9zM588.4 515.8H208.6c-4.9 0-8.9-4-8.9-8.9s4-8.9 8.9-8.9h379.7c4.9 0 8.9 4 8.9 8.9 0.1 4.9-3.9 8.9-8.8 8.9z" fill="#282828" p-id="106095"></path><path d="M673.3 113.3c0 19.6-15.9 35.5-35.5 35.5h-346c-19.6 0-35.5-15.9-35.5-35.5v-6.7c0-19.6 15.9-35.5 35.5-35.5h346c19.6 0 35.5 15.9 35.5 35.5v6.7z" fill="#1A6DFF" p-id="106096"></path><path d="M637.8 157.6h-346c-24.5 0-44.4-19.9-44.4-44.4v-6.7c0-24.5 19.9-44.4 44.4-44.4h346c24.5 0 44.4 19.9 44.4 44.4v6.7c0 24.5-19.9 44.4-44.4 44.4zM291.9 80c-14.7 0-26.6 11.9-26.6 26.6v6.7c0 14.7 11.9 26.6 26.6 26.6h346c14.7 0 26.6-11.9 26.6-26.6v-6.7c0-14.7-11.9-26.6-26.6-26.6h-346z" fill="#282828" p-id="106097"></path><path d="M849.7 758.4c0 106.3-86.2 192.4-192.4 192.4-106.3 0-192.4-86.2-192.4-192.4C464.8 652.1 551 566 657.3 566c106.2 0 192.4 86.1 192.4 192.4z" fill="#FFFFFF" p-id="106098"></path><path d="M657.3 959.7c-111 0-201.3-90.3-201.3-201.3s90.3-201.3 201.3-201.3 201.3 90.3 201.3 201.3-90.3 201.3-201.3 201.3z m0-384.8c-101.2 0-183.5 82.3-183.5 183.5S556.1 942 657.3 942s183.6-82.3 183.6-183.6c-0.1-101.2-82.4-183.5-183.6-183.5z" fill="#282828" p-id="106099"></path><path d="M657.3 553.6v204.9h203.6c-0.2-112.7-91.2-204-203.6-204.9z" fill="#1A6DFF" p-id="106100"></path><path d="M860.9 767.3H657.3c-4.9 0-8.9-4-8.9-8.9V553.6c0-2.4 0.9-4.6 2.6-6.3 1.7-1.7 3.6-2.4 6.3-2.6 116.9 0.9 212.2 96.8 212.4 213.7 0 2.4-0.9 4.6-2.6 6.3-1.6 1.7-3.9 2.6-6.2 2.6z m-194.8-17.8h185.6C847 649.3 766.2 568 666.1 562.7v186.8z" fill="#282828" p-id="106101"></path><path d="M794.1 903.7c-2.3 0-4.6-0.9-6.3-2.6L652.1 764.7c-3.5-3.5-3.4-9.1 0-12.6 3.5-3.5 9.1-3.4 12.6 0l135.7 136.5c3.5 3.5 3.4 9.1 0 12.6-1.8 1.7-4 2.5-6.3 2.5z" fill="#282828" p-id="106102"></path></svg>
                测试报告
            </a>
            {% endif %}
        </div>
    </div>
    {% if api_num > 0 %}
    <table id="api-table" class="table card-table table-vcenter  datatable" >
        <thead>
        <tr>
            <th style="font-size: 13px" class="w-1">No.</th>
            <th style="font-size: 13px">接口名称</th>
            <th style="font-size: 13px">URL</th>
            <th style="font-size: 13px">状态</th>
            <th style="font-size: 13px">更新时间</th>
            <th></th>
        </tr>
        </thead>
        <tbody>
        {% for api in apis %}
        <tr>
            <td><span class="text-muted">{{ api.id }}</span></td>
            <td>{{ api.apiname }}</td>
            <td  class="log-text">
                <a href="{{ api.url }}" target="_blank">{{ api.url }}</a>
            </td>
            {% if api.status == '下线' %}
            <td><span class="badge bg-dark">下线</span></td>
            {% elif api.status == '失败' %}
            <td><span class="badge bg-red">失败</span></td>
            {% elif api.status == '成功' %}
            <td><span class="badge bg-success">成功</span></td>
            {% elif api.status == '执行中' %}
            <td><div class="loader2"></div></td>
            {% else %}
            <td><span class="badge">待执行</span></td>
            {% endif %}
            <td>{{ api.ctime }}</td>
            <td>
                <div class="btn-list flex-nowrap">
                    <a onclick="jump_to_case_page('{{ api.apiname }}')"  class="btn btn-white w-100">
                        <svg t="1638001937049" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="89420" width="200" height="200"><path d="M512 512m-512 0a512 512 0 1 0 1024 0 512 512 0 1 0-1024 0Z" fill="#7079FF" p-id="89421"></path><path d="M320 352c9.6 0 16 6.4 16 16v336h304c9.6 0 16 6.4 16 16s-6.4 16-16 16H336c-17.6 0-32-14.4-32-32V368c0-9.6 6.4-16 16-16z m368-64c17.6 0 32 14.4 32 32v320c0 17.6-14.4 32-32 32H400c-17.6 0-32-14.4-32-32V320c0-17.6 14.4-32 32-32h288z m0 32H400v320h288V320z m-118.4 97.6c3.2 1.6 6.4 3.2 8 8 1.6 3.2 1.6 8 0 11.2l-38.4 104c-3.2 8-11.2 11.2-17.6 8s-11.2-11.2-8-17.6l38.4-105.6c1.6-8 9.6-11.2 17.6-8z m-80 12.8c4.8 1.6 9.6 4.8 9.6 9.6 1.6 4.8 0 9.6-4.8 14.4L464 484.8l30.4 30.4c3.2 3.2 4.8 8 3.2 12.8-1.6 4.8-4.8 8-9.6 9.6s-9.6 0-12.8-3.2l-40-40s-1.6-1.6-1.6-3.2c-3.2-4.8-3.2-12.8 1.6-17.6l40-40c3.2-3.2 9.6-4.8 14.4-3.2z m123.2 3.2l40 40c4.8 4.8 4.8 12.8 1.6 17.6 0 1.6-1.6 1.6-1.6 3.2l-40 40c-4.8 4.8-14.4 4.8-19.2 0s-4.8-14.4 0-19.2l30.4-30.4-32-30.4c-4.8-4.8-4.8-14.4 0-19.2 6.4-6.4 14.4-6.4 20.8-1.6z" fill="#FFFFFF" p-id="89422"></path></svg>
                        用例
                    </a>
                    {% if api.status in '执行中' or api.status == '下线' %}
                    <a  class="btn btn-white w-100 disabled">
                        <svg t="1638001356313" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="73544" width="200" height="200"><path d="M511.488 511.488m-511.488 0a511.488 511.488 0 1 0 1022.976 0 511.488 511.488 0 1 0-1022.976 0Z" fill="#E0E2E1" p-id="73545"></path><path d="M766.464 560.64c27.136-18.944 34.304-56.32 15.36-83.456-4.096-6.144-9.216-11.264-15.36-15.36l-318.464-219.136c-27.136-18.944-65.024-11.776-83.456 15.36-6.656 10.24-10.752 22.016-10.752 34.304v438.272c0 33.28 27.136 60.416 59.904 60.416 12.288 0 24.064-3.584 34.304-10.752l318.464-219.648z" fill="#1AAA5E" p-id="73546"></path></svg>
                        执行
                    </a>
                    {% else %}
                    <a onclick="run_task_content('{{ api.apiname }}')" class="btn btn-white w-100">
                        <svg t="1638001356313" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="73544" width="200" height="200"><path d="M511.488 511.488m-511.488 0a511.488 511.488 0 1 0 1022.976 0 511.488 511.488 0 1 0-1022.976 0Z" fill="#E0E2E1" p-id="73545"></path><path d="M766.464 560.64c27.136-18.944 34.304-56.32 15.36-83.456-4.096-6.144-9.216-11.264-15.36-15.36l-318.464-219.136c-27.136-18.944-65.024-11.776-83.456 15.36-6.656 10.24-10.752 22.016-10.752 34.304v438.272c0 33.28 27.136 60.416 59.904 60.416 12.288 0 24.064-3.584 34.304-10.752l318.464-219.648z" fill="#1AAA5E" p-id="73546"></path></svg>
                        执行
                    </a>
                    {% endif %}
                    <a onclick="edit_task_content('{{ api.id }}','{{ api.apiname }}','{{ api.url }}')" class="btn btn-white w-100" data-bs-toggle="modal" data-bs-target="#modal-edit-api">
                        <svg t="1638686685621" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="7671" width="200" height="200"><path d="M512 512m-512 0a512 512 0 1 0 1024 0 512 512 0 1 0-1024 0Z" fill="#5866C7" p-id="7672"></path><path d="M466.304 192l-0.064 64H320a64 64 0 0 0-63.552 56.512L256 320v384a64 64 0 0 0 56.512 63.552L320 768h384a64 64 0 0 0 63.552-56.512L768 704V557.696h64v-239.36V704a128 128 0 0 1-128 128H320a128 128 0 0 1-128-128V320a128 128 0 0 1 128-128h146.304z" fill="#FFFFFF" p-id="7673"></path><path d="M788.992 267.008a32 32 0 0 1 0 45.248l-316.8 316.8a32 32 0 0 1-45.184-45.312l316.8-316.8a32 32 0 0 1 45.184 0z" fill="#FFFFFF" p-id="7674"></path></svg>
                        编辑
                    </a>
                    <a href="/api_test/automation/{{ taskname }}/{{ api.apiname }}/result/{{ api.run_id }}" class="btn btn-white w-100">
                        <svg t="1638000499279" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="44379" width="200" height="200"><path d="M512 512m-512 0a512 512 0 1 0 1024 0 512 512 0 1 0-1024 0Z" fill="#D2E2AC" p-id="44380"></path><path d="M508.8 515.2m-344 0a344 344 0 1 0 688 0 344 344 0 1 0-688 0Z" fill="#90B93E" p-id="44381"></path><path d="M360 520c-6.4-6.4-17.6-8-24-1.6-6.4 6.4-8 17.6-1.6 24l112 120c6.4 8 17.6 8 25.6 0l243.2-272c6.4-6.4 6.4-17.6-1.6-24-6.4-6.4-17.6-6.4-24 1.6L459.2 625.6l-99.2-105.6z" fill="#FFFFFF" opacity=".97" p-id="44382"></path></svg>
                        结果
                    </a>
                    <div class="dropdown">
                        <button class="btn dropdown-toggle align-text-top" data-bs-boundary="viewport" data-bs-toggle="dropdown">
                            更多
                        </button>
                        <div class="dropdown-menu dropdown-menu-end">
                            {% if api.status == '下线' %}
                            <a onclick="set_task_content_status('{{ api.id }}','待执行')" class="dropdown-item" >
                                <svg t="1638005794383" class="icon dropdown-item-icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="144253" width="200" height="200"><path d="M512 1024C230.4 1024 0 793.6 0 512S230.4 0 512 0s512 230.4 512 512-230.4 512-512 512z m0-921.6c-225.28 0-409.6 184.32-409.6 409.6s184.32 409.6 409.6 409.6 409.6-184.32 409.6-409.6-184.32-409.6-409.6-409.6z" fill="#999999" p-id="144254"></path><path d="M512 358.4c30.72 0 51.2 20.48 51.2 51.2v256c0 30.72-20.48 51.2-51.2 51.2s-51.2-20.48-51.2-51.2V409.6c0-30.72 20.48-51.2 51.2-51.2z" fill="#4A72FF" p-id="144255"></path><path d="M645.12 512L512 378.88 378.88 512c-20.48 20.48-51.2 20.48-71.68 0-20.48-20.48-20.48-51.2 0-71.68l204.8-204.8 204.8 204.8c20.48 20.48 20.48 51.2 0 71.68-20.48 20.48-51.2 20.48-71.68 0z" fill="#4A72FF" p-id="144256"></path></svg>
                                上线
                            </a>
                            {% else %}
                            <a onclick="set_task_content_status('{{ api.id }}','下线')" class="dropdown-item" >
                                <svg t="1638001677230" class="icon me-2" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="84844" width="200" height="200"><path d="M768 64H256C147.2 64 64 147.2 64 256v512c0 108.8 83.2 192 192 192h512c108.8 0 192-83.2 192-192V256c0-108.8-83.2-192-192-192zM512 832L256 576h192V256h128v320h192l-256 256z" fill="#C4C528" p-id="84845"></path></svg>
                                下线
                            </a>
                            {% endif %}
                            <div class="dropdown-divider"></div>
                            <a onclick="del_task_content('{{ api.id }}','{{ taskname }}','{{ api.apiname }}')" class="dropdown-item" data-bs-toggle="modal" data-bs-target="#modal-danger" >
                                <svg t="1635400029781" class="icon me-2" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="17941" width="200" height="200"><path d="M877.79 217.23H624.22c0-36.02-29.2-65.23-65.23-65.23H465c-36.02 0-65.23 29.2-65.23 65.23H146.21c-18.01 0-32.61 14.6-32.61 32.61 0 18.01 14.6 32.61 32.61 32.61h49.75l14.43 528.79c1.06 33.91 25.21 60.76 54.64 60.76h493.93c29.43 0 53.58-26.86 54.64-60.76l14.48-528.79h49.7c18.01 0 32.61-14.6 32.61-32.61 0.01-18.01-14.59-32.61-32.6-32.61zM364.24 748.41c-17.98 0.82-33.4-10.01-34.44-24.19L308 427.56c-1.04-14.18 12.69-26.34 30.67-27.16 17.98-0.82 33.4 10.01 34.45 24.19l21.8 296.67c1.04 14.17-12.7 26.33-30.68 27.15z m180.37-25.42c0 14.2-14.6 25.72-32.61 25.72-18.01 0-32.61-11.51-32.61-25.72V425.83c0-14.2 14.6-25.72 32.61-25.72 18.01 0 32.61 11.51 32.61 25.72v297.16zM716 427.56l-21.8 296.67c-1.04 14.18-16.46 25.01-34.44 24.19-17.98-0.82-31.71-12.98-30.67-27.16l21.8-296.67c1.04-14.18 16.46-25.01 34.44-24.19 17.98 0.82 31.72 12.98 30.67 27.16z" fill="#FF5D5D" p-id="17942"></path></svg>
                                删除
                            </a>
                        </div>
                    </div>
                </div>
            </td>
        </tr>
        {% endfor %}
        </tbody>
    </table>
    <div class="dropdown-divider"></div>
    {% else %}
    <div class="empty">
        <div class="empty-img">
            <img src="/static/tabler/static/illustrations/undraw_printing_invoices_5r4r.svg">
        </div>
        <p class="empty-title">No results found</p>
    </div>
    {% endif %}
</div>

<div class="modal modal-blur fade" id="modal-new-api" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">创建接口</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-lg-12">
                        <div class="api_content">
                            <div class="col apiform">
                                <div class="input-group">
                                    <span class="input-group-text">
                                        接口名称
                                    </span>
                                    <input id="apiname" type="text" class="form-control"  placeholder="请输入任务名称.."  autocomplete="off">
                                </div>
                                <div class="input-group mt-3">
                                    <span class="input-group-text">
                                        接口地址
                                    </span>
                                    <input id="url" type="text" class="form-control"  placeholder="请输入任务名称.."  autocomplete="off">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <a  class="btn btn-link link-secondary" data-bs-dismiss="modal">取消</a>
                <a  class="btn btn-primary ms-auto"  id="create_api">
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><line x1="12" y1="5" x2="12" y2="19" /><line x1="5" y1="12" x2="19" y2="12" /></svg>
                    创建
                </a>
            </div>
        </div>
    </div>
</div>

<div class="modal modal-blur fade" id="modal-edit-api" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">编辑接口</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-lg-12">
                        <div class="api_content">
                            <div class="col apiform">
                                <div class="input-group">
                                    <span class="input-group-text">
                                        接口名称
                                    </span>
                                    <input id="new_apiname" type="text" class="form-control"  placeholder="请输入任务名称.."  autocomplete="off">
                                </div>
                                <div class="input-group mt-3">
                                    <span class="input-group-text">
                                        接口地址
                                    </span>
                                    <input id="new_url" type="text" class="form-control"  placeholder="请输入任务名称.."  autocomplete="off">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <a  class="btn btn-link link-secondary" data-bs-dismiss="modal">取消</a>
                <a  class="btn btn-info ms-auto"  id="edit_api_confirm">
                    <svg t="1638686890624" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="8488" width="200" height="200"><path d="M286.487273 759.854545c-5.818182 0-11.403636-2.094545-16.058182-6.283636a354.816 354.816 0 0 1-111.010909-257.163636c0-30.487273 3.956364-60.741818 11.636363-90.065455 3.258182-12.567273 16.058182-19.781818 28.392728-16.523636s19.781818 16.058182 16.523636 28.392727c-6.749091 25.367273-10.007273 51.898182-10.007273 78.429091 0 85.410909 34.210909 164.770909 96.349091 223.185455a23.179636 23.179636 0 0 1-15.825454 40.02909zM510.370909 848.756364c-6.516364 0-13.032727-2.792727-17.454545-7.68s-6.981818-11.170909-6.283637-17.687273l4.189091-53.527273-89.832727 43.054546c-6.981818 10.705455-20.712727 13.265455-31.650909 6.283636-10.705455-6.981818-13.498182-21.876364-6.516364-32.814545 4.421818-6.749091 10.472727-12.101818 18.152727-15.592728l92.16-44.218182c14.429091-6.981818 31.185455-5.818182 44.683637 3.49091 13.265455 9.076364 20.712727 24.669091 19.549091 40.727272l-2.327273 30.021818C691.432727 788.247273 814.545455 656.523636 814.545455 496.407273c0-90.298182-39.563636-175.476364-108.218182-233.890909a23.505455 23.505455 0 0 1-2.792728-32.814546c8.378182-9.774545 23.04-10.938182 32.814546-2.792727 79.127273 67.258182 124.741818 165.469091 124.741818 269.265454 0 194.327273-157.323636 352.581818-350.72 352.581819z m-19.549091-81.221819zM261.818182 305.570909a23.249455 23.249455 0 0 1-17.687273-38.4c66.792727-78.196364 163.84-123.112727 266.24-123.112727 6.516364 0 13.032727 2.792727 17.454546 7.68s6.981818 11.170909 6.283636 17.687273l-4.189091 53.527272 89.832727-43.054545c6.981818-10.705455 20.945455-13.265455 31.650909-6.283637 10.705455 6.981818 13.498182 21.876364 6.516364 32.814546-4.421818 6.749091-10.472727 12.101818-18.152727 15.592727l-92.16 44.218182c-14.661818 6.981818-31.185455 5.585455-44.683637-3.490909-13.265455-9.076364-20.712727-24.669091-19.549091-40.727273l2.327273-30.021818c-79.825455 6.516364-153.832727 44.218182-206.196363 105.658182-4.654545 5.12-11.170909 7.912727-17.687273 7.912727z" fill="#ffffff" p-id="8489"></path><path d="M528.290909 270.429091c-8.843636 0-17.687273-2.792727-25.367273-7.912727-13.265455-9.076364-20.712727-24.669091-19.549091-40.727273l7.912728-102.4c1.163636-16.290909 10.705455-30.254545 25.367272-37.236364 14.661818-6.981818 31.650909-5.818182 45.149091 3.258182l84.48 58.181818c20.48 14.661818 25.6 42.821818 11.403637 63.069091-3.956364 6.050909-10.007273 11.403636-17.687273 15.127273l-92.16 44.218182c-6.283636 2.792727-13.032727 4.421818-19.549091 4.421818z m9.309091-145.454546l-7.68 98.676364 89.832727-43.985454-42.123636-26.763637-40.029091-27.927273zM506.647273 223.418182zM484.305455 915.316364c-8.843636 0-17.687273-2.56-25.367273-7.912728 0 0-0.232727 0-0.232727-0.232727l-84.247273-58.181818a45.777455 45.777455 0 0 1-11.403637-63.069091c3.956364-6.050909 10.007273-11.403636 17.687273-14.894545l92.16-44.218182c14.429091-6.981818 31.185455-5.818182 44.683637 3.490909 13.265455 9.076364 20.712727 24.669091 19.54909 40.727273l-7.912727 102.4c-1.163636 16.290909-10.705455 30.254545-25.367273 37.236363-6.050909 3.025455-12.8 4.654545-19.54909 4.654546z m6.283636-145.454546l-89.832727 43.054546 42.123636 26.763636 40.727273 28.392727 6.981818-98.210909z m0.232727-2.327273z" fill="#ffffff" p-id="8490"></path></svg>
                    更新
                </a>
            </div>
        </div>
    </div>
</div>


<div class="modal modal-blur fade" id="modal-danger" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog modal-sm modal-dialog-centered" role="document">
        <div class="modal-content">
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            <div class="modal-status bg-danger"></div>
            <div class="modal-body text-center py-4">
                <svg xmlns="http://www.w3.org/2000/svg" class="icon mb-2 text-danger icon-lg" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M12 9v2m0 4v.01" /><path d="M5 19h14a2 2 0 0 0 1.84 -2.75l-7.1 -12.25a2 2 0 0 0 -3.5 0l-7.1 12.25a2 2 0 0 0 1.75 2.75" /></svg>
                <h3>确认删除?</h3>
                <div class="text-muted api-name"></div>
            </div>
            <div class="modal-footer">
                <div class="w-100">
                    <div class="row">
                        <div class="col">
                            <a  class="btn btn-white w-100" data-bs-dismiss="modal">
                            取消
                            </a>
                        </div>
                        <div class="col">
                            <a  id="del_api_confirm" class="btn btn-danger w-100">
                            确认
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


{% endblock %}

{% block api_script %}
<script>


    $('#new_api').on('click', function () {
        $('#apiname').val('')
        $('#url').val('')
    });

    function myrefresh() {
        window.location.reload();
    }

    window.onload = function () {
        if('{{ running_task_num }}' != '0'){
            setTimeout('myrefresh()', 5000);
        }
    }

    console.log(owner)


    $('#create_api').on('click', function () {
        let taskname = '{{ taskname }}';
        let apiname = $('#apiname').val().trim();
        let url = $('#url').val().trim();
        if(apiname && url){
            $.ajax({
                url: "/api_test/api/create_task_content",
                type: "POST",
                async: true,
                cache: false,
                data:{
                    taskname: taskname,
                    apiname: apiname,
                    url: url,
                },
                beforeSend: function () {
                    loading();
                    },
                complete: function () {
                    removeLoading()
                },
                success: function (data) {
                    if(data['status'] != 1 ){
                        Spop(SPOP_TYPE['error'],data['msg'])
                    }else{
                        location.reload()
                    }
                }
            });
        }else{
            Spop(SPOP_TYPE['error'],'接口名称和地址不能为空')
        }
    });

    $('#run_all_task').on('click', function () {
        let taskname = '{{ taskname }}'
        $.ajax({
            url: "/api_test/api/set_apiname_status",
            type: "POST",
            async: true,
            cache: false,
            data:{
                taskname: taskname,
                new_status: '执行中'
            },
            beforeSend: function () {
                loading();
            },
            complete: function () {},
            success: function (data) {
                if(data['status'] != 1 ){
                    removeLoading()
                    Spop(SPOP_TYPE['error'],data['msg'])
                }else{
                    let run_id = (new Date()).format('Y-m-d-H:i:s')
                    $.ajax({
                        url: "/api_test/api/run_jenkins_job",
                        type: "POST",
                        async: true,
                        cache: false,
                        data:{
                            jobname:'run_task_all_apiname',
                            taskname: taskname,
                            owner:owner,
                            run_id: owner+'执行-'+run_id
                        },
                        beforeSend: function () {},
                        complete: function () {
                            removeLoading()
                        },
                        success: function (data) {
                            if(data['status'] != 1 ){
                                Spop(SPOP_TYPE['error'],data['msg'])
                            }else{
                                location.reload()
                            }
                        }
                    });
                }
            }
        });
    });

    function edit_task_content(id,apiname,url){
        $('#new_apiname').val(apiname)
        $('#new_url').val(url)
        $('#edit_api_confirm').on('click', function () {
            let new_apiname = $('#new_apiname').val()
            let new_url = $('#new_url').val()
            $.ajax({
                url: "/api_test/api/edit_task_content",
                type: "POST",
                async: true,
                cache: false,
                data:{
                    id: id,
                    new_apiname:new_apiname,
                    new_url:new_url
                },
                beforeSend: function () {
                    loading();
                    },
                complete: function () {
                    removeLoading()
                },
                success: function (data) {
                    if(data['status'] != 1 ){
                        Spop(SPOP_TYPE['error'],data['msg'])
                    }else{
                        location.reload()
                    }
                }
            });
        });

    }

    function set_task_content_status(id,status){
        window.event.preventDefault()
        $.ajax({
            url: "/api_test/api/set_task_content_status",
            type: "POST",
            async: true,
            cache: false,
            data:{
                id: id,
                new_status:status
            },
            beforeSend: function () {
                loading();
            },
            complete: function () {
                removeLoading()
            },
            success: function (data) {
                if(data['status'] != 1 ){
                    Spop(SPOP_TYPE['error'],data['msg'])
                }else{
                    location.reload()
                }
            }
        });
    }

    function run_task_content(apiname){
        window.event.preventDefault()
        let run_id = (new Date()).format('Y-m-d-H:i:s')
        $.ajax({
            url: "/api_test/api/run_task_content",
            type: "POST",
            async: true,
            cache: false,
            data:{
                taskname:'{{ taskname }}',
                apiname:apiname,
                owner:owner,
                run_id:owner+'执行-'+run_id
            },
            beforeSend: function () {
                loading();
            },
            complete: function () {
                removeLoading()
            },
            success: function (data) {
                if(data['status'] != 1 ){
                    Spop(SPOP_TYPE['error'],data['msg'])
                }else{
                    location.reload()
                    //Swal.fire('执行成功',data['data'],'success')
                }
            }
        });
    }

    function del_task_content(id,taskname,apiname){
        $('.api-name').text(apiname)
        $('#del_api_confirm').on('click', function () {
            $.ajax({
                url: "/api_test/api/delete_task_content",
                type: "POST",
                async: true,
                cache: false,
                data:{
                    id: id,
                    taskname:taskname,
                    apiname:apiname
                },
                beforeSend: function () {
                    loading();
                    },
                complete: function () {
                    removeLoading()
                },
                success: function (data) {
                    if(data['status'] != 1 ){
                        Spop(SPOP_TYPE['error'],data['msg'])
                    }else{
                        location.reload()
                    }
                }
            });
        });

    }

    function jump_to_case_page(apiname){
        let taskname = '{{ taskname }}'
        $.ajax({
            url: "/api_test/api/get_newcase",
            type: "POST",
            async: true,
            cache: false,
            data:{
                taskname: taskname,
                apiname:apiname
            },
            beforeSend: function () {
                loading();
            },
            complete: function () {
                removeLoading()
            },
            success: function (data) {
                if(data['status'] != 1 ){
                    Spop(SPOP_TYPE['error'],data['msg'])
                }else{
                    if(data['newest_case'] != 'no case'){
                        window.location.href = '/api_test/automation/{{ taskname }}/'+apiname+'/'+data['newest_case']

                    }else{
                        window.location.href = '/api_test/automation/{{ taskname }}/'+apiname
                    }
                }
            }
        });
    }
</script>
{% endblock %}