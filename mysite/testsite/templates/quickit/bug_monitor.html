{% load static %}
<!DOCTYPE html>
<html style="height: 100%">
<title>Master List</title>
   <head>
       <meta charset="utf-8">
       <link rel="icon" href="/static/image/logo-nemo.png">
   </head>
   <script src="/static/plugin/happynewyear/js/jquery.min.js" type="text/javascript" charset="utf-8"></script>
   <body style="height: 100%; margin: 0">
   <!-- jQuery -->
   <script src="/static/AdminLTE-3.0.1/plugins/jquery/jquery.min.js"></script>
   <script src="https://www.jq22.com/jquery/echarts-4.2.1.min.js"></script>

   <div id="container" style="height: 100%" ></div>
   <script type="text/javascript">
           function myrefresh()
           {
               //$("#container").show();
               document.getElementById("canvas").style.display="none";
               document.getElementById("test").style.display="none";
           }
           var sleep = function(time) {
               var startTime = new Date().getTime() + parseInt(time, 10);
               while(new Date().getTime() < startTime) {}
           };

           var nickname_list=[]
           var bugslist=[]
           //sleep(10000)
           $.ajax({
            url: "/bug_monitor_api/",
            type: "POST",
            async:true,
            cache: false,

            beforeSend: function () {

            },
            complete: function () {
            },
            success: function (data) {
                setTimeout('myrefresh()',10000);
                console.log(data)
                for(var i=0;i<data['result'].length;i++){
                    nickname_list.push(data['result'][i][0])
                }
                for(var i=0;i<data['result'].length;i++){
                    bugslist.push(data['result'][i][2])
                }
                console.log(nickname_list)
                console.log(bugslist)
                var dom = document.getElementById("container");
            var myChart = echarts.init(dom);
            var app = {};
            var option = null;

            option = {
                backgroundColor: '#0E2A43',
                title:{
                    text:'九月高手榜',
                    textStyle:{
                        color:'white',
                        fontSize:50,
                        fontFamily:'sans-serif',
                        fontStyle:'oblique'

                    },
                    textAlign:'top',
                    left:'center'
                },

                tooltip: {
                    show: true,
                    formatter: "{b}:{c}"
                    },
            grid: {
                    left: '5%',
                    top: '12%',
                    right: '1%',
                    bottom: '8%',
                    containLabel: true
                    },

                xAxis: {
                        type: 'category',
                        axisTick: {
                            show: false,
                            alignWithLabel: false,
                            length: 5,

                        },
                        "splitLine": { //网格线
                            "show": false
                        },
                        inverse: 'true', //排序
                        axisLine: {
                            show: false,
                            lineStyle: {
                                color: '#fff',
                            }
                        },
                        data: nickname_list
                    },
                yAxis: [{
                    type: 'value',
                    show:false,
                    position: 'top',
                    axisTick: {
                        show: false
                    },
                    axisLine: {
                        show: false,
                        lineStyle: {
                            color: '#fff',
                        }
                    },
                    splitLine: {
                        show: false
                    },
                }],
                series: [{
                        name: '能耗值',
                        type: 'bar',
                        label: {
                            normal: {
                                show: true,
                                position: 'top',
                                formatter: '{c}',
                                textStyle: {
                                    color: 'white' //color of value
                                }
                            }
                        },
                        itemStyle: {
                            //通常情况下：
                            normal: {
                                barBorderRadius: 8,
                                //每个柱子的颜色即为colorList数组里的每一项，如果柱子数目多于colorList的长度，则柱子颜色循环使用该数组
                                color: function (params) {
                                    var colorList = [
                                        ['#b250ff', 'rgba(11,42,84,.3)'],
                                        ['#ff9717', 'rgba(11,42,84,.3)'],
                                        ['#61dbe8', 'rgba(11,42,84,.3)'],
                                        ['#83ce48', 'rgba(11,42,84, 0.3)'],
                                        ['#ce1c36', 'rgba(11,42,84, 0.3)'],
                                    ];
                                    var index = params.dataIndex;
                                    if (params.dataIndex >= colorList.length) {
                                        index = params.dataIndex - colorList.length;
                                    }
                                    return new echarts.graphic.LinearGradient(0, 0, 0, 1,
                                        [{
                                                offset: 0,
                                                color: colorList[index][0]
                                            },
                                            {
                                                offset: 1,
                                                color: colorList[index][1]
                                            }
                                        ]);
                                },
                            },
                        },
                        barGap: '0%',
                        barCategoryGap: '50%',
                        data: bugslist
                    }]
            };

            if (option && typeof option === "object") {
                myChart.setOption(option, true);
            }

            }
        })

       </script>
   </body>
</html>